<page-centered-container>
    <form #EzTagAgreementForm="ngForm" validation-focus name="cavveEzTagAgreementForm"
          class="u-spacing--widthFill"
          [ngStyle.lt-md]="{'margin-bottom':'30px'}">

        <storefront-utility #storefront></storefront-utility>
        <div fxLayout="column">

            <!--Billing Information Section-->
            <card-container id="billingInfoSection">
                <section fxLayout="column"
                         fxLayoutAlign="start start">

                    <div fxLayout="row"
                         fxLayoutAlign="space-between start"
                         class="u-spacing--widthFill">
                        <header fxLayout="column">
                            <h2 id="billingInfoHdr">
                                {{cmsContent.billingInfoHeader}}
                            </h2>
                            <mat-divider></mat-divider>
                        </header>

                        <a class="editButton" (click)="openEditBillingModal()"
                           fxFlex="none" aria-label="Edit">
                            Edit
                        </a>
                    </div>
                </section>
                <section fxLayout="column"
                         style="margin-top: 24px">

                    <payment-display *ngIf="billingInfo"
                                     [billingType]="billingInfo.billingType"
                                     [bankDetails]="billingInfo.eft"
                                     [creditCard]="billingInfo.credit"
                                     [hideTitle]="true"
                                     [showAccountNumber]="true"
                                     [showNameOnCard]="true"
                                     [showLabels]="true">
                    </payment-display>
                    <address-display *ngIf="billingInfo && billingInfo.billingType"
                                     [address]="billingInfo.billingType === BillingType.Credit ? billingInfo.credit : billingInfo.eft"
                                     [international]="billingInfo.billingType === BillingType.Credit ? billingInfo.credit.international : billingInfo.eft.international"
                                     [showLabels]="true">
                    </address-display>
                </section>
            </card-container>

            <!--EZ Tag Information Section-->
            <card-container id="vehicleInfoSection"
                            fxFlexOffset="21px">

                <section fxLayout="column"
                         fxLayoutAlign="start start"
                         class="u-spacing--widthFill">

                    <div fxLayout="row"
                         fxLayoutAlign="space-between start"
                         class="u-spacing--widthFill">
                        <header fxLayout="column">
                            <h2 id="vehicleInfoHdr">
                                {{cmsContent.vehicleInfoHeader}}
                            </h2>
                            <mat-divider></mat-divider>
                        </header>

                        <a class="editButton" (click)="openEditVehiclesModal()"
                           fxFlex="none" aria-label="Edit">
                            Edit
                        </a>
                    </div>
                </section>
                <section fxLayout="column"
                         fxLayoutAlign="center start" style="margin-top: 24px">

                    <vehicle-display *ngIf="vehicleInfo"
                                     [vehicleInfo]="vehicleInfo">
                    </vehicle-display>
                </section>
            </card-container>

            <!--Choose Delivery Method Section-->
            <card-container id="chooseDeliveryMethodSection"
                            fxFlexOffset="21px">
                <section fxLayout="row" fxLayout.lt-md="column">
                    <article fxLayout="column" fxFlex="grow"
                             fxFlexOrder="1"
                             fxFlexOrder.lt-md="2"
                             ngClass.lt-md="u-spacing--widthFill"
                             [ngStyle.lt-md]="{'margin-top' : '24px'}">
                        <header>
                            <h2 id="chooseDeliveryMethodHdr">
                                {{cmsContent.deliveryMethodHeader}}
                            </h2>
                        </header>
                        <mat-divider></mat-divider>
                    </article>
                    <article fxLayout="column"
                             fxFlex="none"
                             fxLayoutAlign="start end"
                             fxLayoutAlign.lt-md="start start"
                             style="font-weight: bold"
                             fxFlexOrder="2"
                             fxFlexOrder.lt-md="1"
                             ngClass.lt-md="u-spacing--widthFill">
                    </article>
                </section>
                <section fxLayout="column"
                         fxLayoutAlign="center start" style="margin-top: 24px">

                    <choose-delivery-method #DeliveryMethodsOptions>

                    </choose-delivery-method>

                </section>
            </card-container>

            <!--Order Summary Section-->
            <card-container id="orderSummarySection"
                            fxFlexOffset="21px">
                <section fxLayout="row" fxLayout.lt-md="column">
                    <article fxLayout="column" fxFlex="grow"
                             fxFlexOrder="1"
                             fxFlexOrder.lt-md="2"
                             ngClass.lt-md="u-spacing--widthFill"
                             [ngStyle.lt-md]="{'margin-top' : '24px'}">
                        <header>
                            <h2 id="orderSummaryHdr">
                                {{cmsSectionConfirmOrderSummary.Title}}
                            </h2>
                        </header>
                        <mat-divider></mat-divider>
                    </article>
                    <article fxLayout="column"
                             fxFlex="none"
                             fxLayoutAlign="start end"
                             fxLayoutAlign.lt-md="start start"
                             style="font-weight: bold"
                             fxFlexOrder="2"
                             fxFlexOrder.lt-md="1"
                             ngClass.lt-md="u-spacing--widthFill">
                    </article>
                </section>
                <section fxLayout="column"
                         fxLayoutAlign="center"
                         style="margin-top: 24px;">

                    <cavve-payment-summary [isConfirmPage]="true"
                                           [fees]="createAccountFromViolationsTotals">
                    </cavve-payment-summary>

                    <!--EZ Tag Agreement Checkbox Section-->
                    <section id="ezTagAgreementSection" style="margin-top:4px;">
                        <!--Text above checkbox-->
                        <article *ngIf="cmsSectionConfirmOrderSummary.LongDescription"
                                 style="margin-top:18px;"
                                 [innerHtml]="cmsSectionConfirmOrderSummary.LongDescription"></article>

                        <!--Checkbox-->
                        <div [error-check]="EzTagAgreementCheck" style="margin-top:18px;">
                            <!--Checkbox and text-->
                            <div fxLayout="row"
                                 fxLayoutAlign="start start"
                                 class="u-spacing--widthFill">
                                <input type="checkbox" name="verifyAgreementChecked" style="width:16px; height:16px;"
                                       #EzTagAgreementCheck="ngModel" [ngModel]="verifyAgreementChecked" required />

                                <label style="margin-top:2px; margin-left:10px;"
                                       [innerHtml]="cmsSectionConfirmOrderSummary.ShortDescription"></label>
                            </div>

                            <!--Validation Text-->
                            <div *ngFor="let error of EzTagAgreementCheck.errors | keyvalue" role="alert">
                                <ng-container *ngIf="EzTagAgreementForm.submitted" [ngSwitch]="error.key">
                                    <p *ngSwitchCase="'required'" class="help-block" [innerHtml]="cmsSectionConfirmOrderSummary.EzTagAgreementValidation"></p>
                                </ng-container>
                            </div>
                        </div>
                    </section>
                </section>

            </card-container>

            <!--Buttons/Links for 'next' & 'cancel' states-->
            <section class="u-spacing__buttonToField--marginTop">
                <wizard-ui (next)="onSubmit($event)"
                           (previous)="onPrevious($event)">
                    <span wizard-next>PAY</span>
                    <span wizard-previous
                          fxLayout="row"
                          fxLayoutAlign="start center">
                        <mat-icon svgIcon="previous-arrow"></mat-icon>
                        Previous
                    </span>
                    <span wizard-cancel>Cancel</span>
                </wizard-ui>
            </section>

        </div>
    </form>
    
</page-centered-container>
